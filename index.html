<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Bản đồ tài chính cá nhân</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Be Vietnam Pro', sans-serif; }
    .chip { @apply inline-flex items-center bg-gray-100 border border-gray-300 rounded-full px-3 py-1 mr-2 mb-2; }
    .chip button { @apply ml-2 text-red-600; }
    .section-title { @apply text-xl font-bold text-red-600 mb-4; }
    @media print { .no-print { display: none !important; } }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-red-600 mb-8">Bản đồ tài chính cá nhân</h1>

    <!-- Phần 1 -->
    <section class="bg-white shadow rounded-lg p-6 mb-8">
      <h2 class="section-title">Phần 1: Làm rõ mục tiêu tài chính</h2>

      <!-- 1 -->
      <div class="mb-6">
        <label class="font-medium block mb-2">1. Mục tiêu/Kế hoạch dài hạn</label>
        <div class="flex gap-2">
          <input id="goal-input" list="goal-suggest" class="flex-1 border rounded px-3 py-2" placeholder="Nhập mục tiêu...">
          <button id="add-goal" type="button" class="px-4 py-2 bg-red-600 text-white rounded">+ Thêm</button>
        </div>
        <datalist id="goal-suggest">
          <option value="Vận hành gia đình">
          <option value="Quỹ học vấn cho con">
          <option value="Quỹ hưu trí">
          <option value="Trả nợ">
          <option value="Gia tăng tài sản/ Để lại di sản">
          <option value="Mở doanh nghiệp riêng">
        </datalist>
      </div>

      <!-- 2 -->
      <div class="mb-6">
        <label class="font-medium block mb-2">2. Mục tiêu bắt buộc (chọn nhiều)</label>
        <div id="must-goals" class="flex flex-wrap"></div>
      </div>

      <!-- 3 -->
      <div class="mb-6">
        <label class="font-medium block mb-2">3. Lý do</label>
        <div class="flex gap-2">
          <input id="reason-input" class="flex-1 border rounded px-3 py-2" placeholder="Nhập lý do...">
          <button id="add-reason" type="button" class="px-4 py-2 bg-red-600 text-white rounded">+ Thêm</button>
        </div>
        <div id="reasons" class="mt-2 flex flex-wrap"></div>
      </div>

      <!-- 4: Quỹ cần thiết -->
      <div id="funds"></div>
    </section>

    <!-- 5 + 6 -->
    <section class="bg-white shadow rounded-lg p-6 mb-8">
      <h2 class="section-title">5–6. Đồng hành & Thời hạn</h2>
      <div class="mb-4">
        <label class="block mb-2">Có ai cùng thực hiện không?</label>
        <label><input type="radio" name="partner" value="no" checked> Không</label>
        <label class="ml-4"><input type="radio" name="partner" value="yes"> Có</label>
      </div>
      <div id="partner-extra" class="hidden mb-4">
        <label class="block mb-2">% đóng góp</label>
        <input id="partner-perc" type="number" class="border rounded px-3 py-2 w-32">
      </div>
      <div>
        <label class="block mb-2">Hoàn thành trong bao lâu (năm)</label>
        <input id="years-all" type="number" class="border rounded px-3 py-2 w-32">
      </div>
    </section>

    <!-- Phần 2 -->
    <section class="bg-white shadow rounded-lg p-6 mb-8">
      <h2 class="section-title">Phần 2: Những yếu tố ảnh hưởng</h2>

      <div class="mb-6">
        <label class="block mb-2">7. Thuận lợi</label>
        <div class="flex gap-2">
          <input id="pos-input" class="flex-1 border rounded px-3 py-2" placeholder="Nhập yếu tố thuận lợi...">
          <button id="add-pos" type="button" class="px-4 py-2 bg-red-600 text-white rounded">+ Thêm</button>
        </div>
        <div id="positives" class="mt-2 flex flex-wrap"></div>
      </div>

      <div class="mb-6">
        <label class="block mb-2">8. Khó khăn</label>
        <div class="flex gap-2">
          <input id="neg-input" class="flex-1 border rounded px-3 py-2" placeholder="Nhập yếu tố khó khăn...">
          <button id="add-neg" type="button" class="px-4 py-2 bg-red-600 text-white rounded">+ Thêm</button>
        </div>
        <div id="negatives" class="mt-2 flex flex-wrap"></div>
      </div>

      <div class="mb-6">
        <label class="block mb-2">9. Khó khăn không thể khắc phục</label>
        <div id="unmit" class="flex flex-wrap"></div>
      </div>

      <div>
        <label class="block mb-2">10. Phương án thay thế</label>
        <div class="flex gap-2">
          <input id="alt-input" class="flex-1 border rounded px-3 py-2" placeholder="Nhập phương án...">
          <button id="add-alt" type="button" class="px-4 py-2 bg-red-600 text-white rounded">+ Thêm</button>
        </div>
        <div id="alts" class="mt-2 flex flex-wrap"></div>
      </div>
    </section>

    <!-- Phần 3 -->
    <section class="bg-white shadow rounded-lg p-6 mb-8">
      <h2 class="section-title">Phần 3: Tổng hợp</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold mb-2">Số tiền trách nhiệm</h3>
          <ul id="resp-list" class="space-y-1"></ul>
          <div class="font-bold mt-2">Tổng: <span id="resp-total">₫0</span></div>
          <div class="mt-4">
            <label class="block mb-2">Đã chuẩn bị</label>
            <input id="resp-prepared" data-money class="border rounded px-3 py-2 w-40">
          </div>
          <div class="mt-2 font-bold text-red-600">Khoảng thiếu: <span id="resp-gap">₫0</span></div>
        </div>
        <div>
          <h3 class="font-semibold mb-2">Số tiền phải tích luỹ</h3>
          <ul id="save-list" class="space-y-1"></ul>
          <div class="font-bold mt-2">Tổng: <span id="save-total">₫0</span></div>
          <div class="mt-4">
            <label class="block mb-2">Mong muốn hoàn thành (%)</label>
            <input id="goal-percent" type="number" class="border rounded px-3 py-2 w-32">
          </div>
        </div>
      </div>
    </section>

    <div class="no-print flex gap-4">
      <button onclick="window.print()" class="px-6 py-3 bg-red-600 text-white rounded">Xuất PDF</button>
    </div>
  </div>

  <script>
    const fmt = new Intl.NumberFormat('vi-VN');
    const money = v => '₫' + fmt.format(+v||0);
    const digits = s => (s||'').replace(/\D/g,'');
    const bindMoney = inp => {
      inp.addEventListener('input', e=>{
        let val = digits(inp.value);
        inp.value = val ? fmt.format(+val) : '';
        calc();
      });
    };

    // state
    const state = { goals:[], must:[], reasons:[], pos:[], neg:[], unmit:[], alts:[] };

    // add goal
    document.getElementById('add-goal').onclick = ()=>{
      const v = document.getElementById('goal-input').value.trim();
      if(v && !state.goals.includes(v)){ state.goals.push(v); }
      document.getElementById('goal-input').value='';
      render();
    };
    // add reason
    document.getElementById('add-reason').onclick = ()=>{
      const v=document.getElementById('reason-input').value.trim();
      if(v){ state.reasons.push(v); }
      document.getElementById('reason-input').value='';
      render();
    };
    // positives
    document.getElementById('add-pos').onclick = ()=>{
      const v=document.getElementById('pos-input').value.trim();
      if(v){ state.pos.push(v); }
      document.getElementById('pos-input').value='';
      render();
    };
    // negatives
    document.getElementById('add-neg').onclick = ()=>{
      const v=document.getElementById('neg-input').value.trim();
      if(v){ state.neg.push(v); }
      document.getElementById('neg-input').value='';
      render();
    };
    // alternatives
    document.getElementById('add-alt').onclick = ()=>{
      const v=document.getElementById('alt-input').value.trim();
      if(v){ state.alts.push(v); }
      document.getElementById('alt-input').value='';
      render();
    };

    // render lists
    function renderChips(arr,id){
      const box=document.getElementById(id); box.innerHTML='';
      arr.forEach((txt,i)=>{
        const c=document.createElement('span');
        c.className='chip'; c.innerHTML=txt+' <button>&times;</button>';
        c.querySelector('button').onclick=()=>{arr.splice(i,1);render();};
        box.appendChild(c);
      });
    }

    function render(){
      // must goals
      const must=document.getElementById('must-goals'); must.innerHTML='';
      state.goals.forEach(g=>{
        const s=document.createElement('div');
        s.className='px-3 py-1 border rounded cursor-pointer mr-2 mb-2';
        if(state.must.includes(g)){ s.classList.add('font-bold','bg-red-50'); }
        s.textContent=g;
        s.onclick=()=>{ if(state.must.includes(g)) state.must=state.must.filter(x=>x!==g); else state.must.push(g); render(); };
        must.appendChild(s);
      });
      // chips
      renderChips(state.reasons,'reasons');
      renderChips(state.pos,'positives');
      renderChips(state.neg,'negatives');
      renderChips(state.unmit,'unmit');
      renderChips(state.alts,'alts');
      calc();
    }

    // calc quỹ
    function val(id){ return +digits(document.getElementById(id)?.value)||0; }
    function calc(){
      let respSum=0, saveSum=0;
      const respList=document.getElementById('resp-list'); respList.innerHTML='';
      const saveList=document.getElementById('save-list'); saveList.innerHTML='';

      // demo: chỉ add các mục chính nếu có trong must
      if(state.must.includes('Vận hành gia đình')){
        const x=val('fam')*val('fam-years'); respSum+=x;
        respList.innerHTML+=`<li>Vận hành gia đình: ${money(x)}</li>`;
      }
      if(state.must.includes('Quỹ học vấn cho con')){
        const x=0; respSum+=x; saveSum+=x;
        respList.innerHTML+=`<li>Quỹ học vấn: ${money(x)}</li>`;
        saveList.innerHTML+=`<li>Quỹ học vấn: ${money(x)}</li>`;
      }
      if(state.must.includes('Quỹ hưu trí')){
        const x=0; saveSum+=x; saveList.innerHTML+=`<li>Quỹ hưu trí: ${money(x)}</li>`;
      }
      if(state.must.includes('Trả nợ')){
        const x=val('debt'); respSum+=x;
        respList.innerHTML+=`<li>Trả nợ: ${money(x)}</li>`;
      }
      if(state.must.includes('Gia tăng tài sản/ Để lại di sản')){
        const x=val('legacy'); respSum+=x;
        respList.innerHTML+=`<li>Di sản: ${money(x)}</li>`;
      }

      document.getElementById('resp-total').textContent=money(respSum);
      document.getElementById('save-total').textContent=money(saveSum);
      const prepared=val('resp-prepared');
      document.getElementById('resp-gap').textContent=money(Math.max(respSum-prepared,0));
    }

    // bind money inputs
    document.querySelectorAll('[data-money]').forEach(bindMoney);

    render();
  </script>
</body>
</html>
